<link rel="import" href="../polymer/polymer.html" />
<link rel="import" href="../iron-flex-layout/classes/iron-flex-layout.html" />
<link rel="import" href="../t-button/t-button.html" />
<link rel="import" href="../iron-icons/iron-icons.html" />
<link rel="import" href="swipe.html" />
<dom-module id="t-carousel">

<template>
<style>
:host{
		display: block;
		position: relative;
	}
	.swipe {
	  overflow: hidden;
	  visibility: hidden;
	  position: relative;
	}
	.swipe-wrap {
	  overflow: hidden;
	  position: relative;
	}
	.swipe-wrap ::content > * {
	  width:100%;
	  position: relative;
	}
	.arrow{
		position: absolute;
		width: 100%;
		top: 50%;
		-webkit-transform: translate(0, -50%);
		-ms-transform: translate(0, -50%);
		-o-transform: translate(0, -50%);
		transform: translate(0, -50%);
	}
	t-button{
		background: rgba(0,0,0,0.5);
	}
	t-button ::content iron-icon{
		color: var(--grey-two,#bbbbbb);
	}
</style>
	<div id='mySwipe' class='swipe'>
      <div class='layout horizontal swipe-wrap'>
      	<content select="*"></content>
      </div>
    </div>
	<template is="dom-if" if="[[!noArrow]]">
		<div class="layout horizontal arrow">
	      <t-button only-icon ico="icons:chevron-left" on-click="prev">prev</t-button>
	      <span class="flex"></span>
	      <t-button only-icon ico="icons:chevron-right" on-click="next">next</t-button>
		</div>
	</template>


</template>
</dom-module>

<script>
    Polymer({
        is: "t-carousel",

        properties: {

            /**
	         * Integer (default:0) - index position Swipe should start at
	         */
            startSlide: {
                type: Number,
                value: 0
            },

            /**
	         * Integer (default:300) - speed of prev and next transitions in milliseconds.
	         */
            speed: {
                type: Number,
                value: 300
            },

            /**
	         * Integer - begin with auto slideshow (time in milliseconds between slides)
	         */
            auto: {
                type: Number,
                value: 10000
            },

            /**
	         * Boolean (default:true) - create an infinite feel with no endpoints
	         */
            continuous: {
                type: Boolean,
                value: true
            },

            /**
	         * Boolean (default:false) - stop any touches on this container from scrolling the page
	         */
            disableScroll: {
                type: Boolean,
                value: false
            },

            /**
	         * Boolean (default:false) - remove arrow from the slide
	         */
            noArrow: {
                type: Boolean,
                value: false
            },

            /**
	         * Boolean (default:false) - stop event propagation
	         */
            stopPropagation: {
                type: Boolean,
                value: false
            },

            mySwipe: {
                type: Object,
                value: function () {
                    return null;
                },
                notify: true
            },

            selected: {
                type: Number,
                notify: true
            },

            totalSlides: {
                type: Number,
                notify: true
            }
        },

        attached: function () {
            var component = this;
            this.selected = this.startSlide;
            this.mySwipe = new Swipe(component.$.mySwipe, {
                startSlide: this.startSlide,
                speed: this.speed,
                auto: this.auto,
                continuous: this.continuous,
                disableScroll: this.disableScroll,
                stopPropagation: this.stopPropagation,
                callback: function (index, elem) {

                    /**
                     * Function - runs at slide change.
                     */
                    component.fire('slide-change', 'index', 'elem');
                    component._setSelected();
                },
                transitionEnd: function (index, elem) {

                    /**
                     * Function - runs at the end slide transition.
                     */
                    component.fire('slide-finish', 'index', 'elem');
                }
            });

            this.totalSlides = this.mySwipe.getNumSlides();
        },

        _setSelected: function () {
            this.selected = this.mySwipe.getPos();
        },
        /**
         * Function - slide to prev
         */
        prev: function () {
            this.mySwipe.prev()
        },

        /**
         * Function - slide to next
         */
        next: function () {
            this.mySwipe.next()
        },

        /**
         * Function slide to set index position (duration: speed of transition in milliseconds)
         */
        slide: function (index, duration) {
            this.mySwipe.slide(index, duration);
        }
    });
</script>