<link rel="import" href="../polymer/polymer.html" />
<link rel="import" href="../t-image/t-image.html" />
<link rel="import" href="t-carousel.html" />
<dom-module id="t-image-carousel">
    <template>
        <style>
        :host {
            display: block;
            position: relative;
        }
        
        /* t-image,
        #backPage {
            background-color: #000;
        } */
        #backoverlay{
            display: none;
        }
        :host[zoomed] #backoverlay{
            display: block;
            z-index:97;
            background: rgba(0,0,0,0.8);
        }
        #backPage {
            z-index: -1;
        }
        :host[zoomed] {
            position: fixed;
            top: 0;
            left: 0;
            z-index: 100;
            height: 100%;
            width: 100%;
        }
        :host[zoomed] t-carousel,:host[zoomed] t-carousel ::content #backoverlay{
            background: transparent;
        }
        
        :host[zoomed] #backPage{
           position: absolute;
           top: 50%;
           width: 100%;
           z-index: 98;
           -webkit-transform: translateY(-50%);
           -ms-transform: translateY(-50%);
           -o-transform: translateY(-50%);
           transform: translateY(-50%);
        }
        </style>
        <t-carousel id="carousel" my-swipe="{{carousel}}" start-slide="{{startSlide}}" speed="{{speed}}" auto="{{auto}}" continuous="{{continuous}}" disable-scroll="{{disableScroll}}" no-arrow="{{noArrow}}" stop-propagation="{{stopPropagation}}" selected="{{selected}}" light-box="{{lightBox}}" zoomed="{{zoomed}}">
            <template is="dom-repeat" items="[[imgArray]]">
                <t-image src="{{item}}" sizing="{{sizing}}" width="{{width}}" loaded="{{imgLoaded}}" height="{{height}}">
                    <template is="dom-if" if="[[!imgLoaded]]">
                        <div class="layout horizontal center center-justified fit" style="z-index: 1;background: #000;">
                            <t-loader active></t-loader>
                        </div>
                    </template>
                </t-image>
            </template>
        </t-carousel>
        <div id="backPage" class="fit " style$="background:url({{lastitem}}); background-size:{{sizing}};height:{{height}}px">
        </div>
        <div id="backoverlay" class="fit" on-click="_closeZoom" style="">
    </template>
</dom-module>
<script>
Polymer({
    is: "t-image-carousel",

    properties: {


        imgArray: {
            type: Array,
            value:function() {
                return [];
            },
            notify: true
        },

        /**
         * Integer (default:0) - index position Swipe should start at
         */
        data: {
            type: Array,
            value:function() {
                return [];
            },
            notify: true
        },

        /**
         * Sets a sizing option for the image.  Valid values are `contain` (full
         * aspect ratio of the image is contained within the element and
         * letterboxed) or `cover` (image is cropped in order to fully cover the
         * bounds of the element), or `null` (default: image takes natural size).
         *
         * @attribute sizing
         * @type string
         * @default null
         */
        sizing: {
            type: String,
            reflectToAttribute: true,
            value: "cover"
        },

        carousel: {
            type: Object,
            value: function() {
                return null;
            },
            notify: true
        },
        /**
         * Can be used to set the width of image (e.g. via binding); size may also be
         * set via CSS.
         *
         * @attribute width
         * @type number
         * @default null
         */
        width: {
            type: Number,
            value: null
        },

        /**
         * Can be used to set the height of image (e.g. via binding); size may also be
         * set via CSS.
         *
         * @attribute height
         * @type number
         * @default null
         */
        height: {
            type: Number,
            value: null
        },
        /**
         * Integer (default:0) - index position Swipe should start at
         */
        startSlide: {
            type: Number,
            value: 0
        },

        /**
         * Integer (default:300) - speed of prev and next transitions in milliseconds.
         */
        speed: {
            type: Number,
            value: 300
        },

        /**
         * Integer - begin with auto slideshow (time in milliseconds between slides)
         */
        auto: {
            type: Number,
            value: 10000
        },

        /**
         * Boolean (default:true) - create an infinite feel with no endpoints
         */
        continuous: {
            type: Boolean,
            value: true
        },

        /**
         * Boolean to handle styles
         */
        zoomed: {
            type: Boolean,
            value: false,
            reflectToAttribute:true,
            notify:true
        },

        /**
         * Boolean (default:true) - create an infinite feel with no endpoints
         */
        lightBox: {
            type: Boolean,
            value: false
        },

        /**
         * Boolean (default:false) - stop any touches on this container from scrolling the page
         */
        disableScroll: {
            type: Boolean,
            value: false
        },

        /**
         * Boolean (default:false) - remove arrow from the slide
         */
        noArrow: {
            type: Boolean,
            value: false
        },

        /**
         * Boolean (default:false) - stop event propagation
         */
        stopPropagation: {
            type: Boolean,
            value: false
        },

        selected: {
            type: Number,
            notify: true
        },

        totalSlides: {
            type: Number,
            notify: true
        }
    },
    observers: [
    'runSetUp(imgArray)',
    '_createData(data)'

    ],
    _createData: function() {
        if (this.data.length > 0) {
            var arr = this.data.slice();
            this.lastitem = arr.pop();
            this.imgArray = arr;
        }
    },

    _closeZoom: function(){
        this.$.carousel._checkLightBox();
    },
    /**
     * Function - slide to prev
     */
    prev: function() {
        this.$.carousel.prev()
    },

    /**
     * Function - slide to next
     */
    next: function() {
        this.$.carousel.next();

    },

    /**
     * Function - slide to next
     */
    runSetUp: function() {
        var comp = this;
        setTimeout(function() {
            comp.$.carousel.mySwipe.setup();
            comp.$.carousel.totalSlides = comp.$.carousel.mySwipe.getNumSlides();
            comp.$.carousel.checkDistributedNodes();
        }, 100);
    },

    /**
     * Function slide to set index position (duration: speed of transition in milliseconds)
     */
    slide: function(index, duration) {
        this.$.carousel.slide(index, duration);
    }
});
</script>
